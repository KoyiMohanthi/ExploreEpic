{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __exportStar = this && this.__exportStar || function (m, exports) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Agent = void 0;\nconst http = __importStar(require(\"http\"));\n__exportStar(require(\"./helpers\"), exports);\nconst INTERNAL = Symbol('AgentBaseInternalState');\nclass Agent extends http.Agent {\n  constructor(opts) {\n    super(opts);\n    this[INTERNAL] = {};\n  }\n  /**\n   * Determine whether this is an `http` or `https` request.\n   */\n  isSecureEndpoint(options) {\n    if (options) {\n      // First check the `secureEndpoint` property explicitly, since this\n      // means that a parent `Agent` is \"passing through\" to this instance.\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      if (typeof options.secureEndpoint === 'boolean') {\n        return options.secureEndpoint;\n      }\n      // If no explicit `secure` endpoint, check if `protocol` property is\n      // set. This will usually be the case since using a full string URL\n      // or `URL` instance should be the most common usage.\n      if (typeof options.protocol === 'string') {\n        return options.protocol === 'https:';\n      }\n    }\n    // Finally, if no `protocol` property was set, then fall back to\n    // checking the stack trace of the current call stack, and try to\n    // detect the \"https\" module.\n    const {\n      stack\n    } = new Error();\n    if (typeof stack !== 'string') return false;\n    return stack.split('\\n').some(l => l.indexOf('(https.js:') !== -1 || l.indexOf('node:https:') !== -1);\n  }\n  createSocket(req, options, cb) {\n    const connectOpts = {\n      ...options,\n      secureEndpoint: this.isSecureEndpoint(options)\n    };\n    Promise.resolve().then(() => this.connect(req, connectOpts)).then(socket => {\n      if (socket instanceof http.Agent) {\n        // @ts-expect-error `addRequest()` isn't defined in `@types/node`\n        return socket.addRequest(req, connectOpts);\n      }\n      this[INTERNAL].currentSocket = socket;\n      // @ts-expect-error `createSocket()` isn't defined in `@types/node`\n      super.createSocket(req, options, cb);\n    }, cb);\n  }\n  createConnection() {\n    const socket = this[INTERNAL].currentSocket;\n    this[INTERNAL].currentSocket = undefined;\n    if (!socket) {\n      throw new Error('No socket was returned in the `connect()` function');\n    }\n    return socket;\n  }\n  get defaultPort() {\n    return this[INTERNAL].defaultPort ?? (this.protocol === 'https:' ? 443 : 80);\n  }\n  set defaultPort(v) {\n    if (this[INTERNAL]) {\n      this[INTERNAL].defaultPort = v;\n    }\n  }\n  get protocol() {\n    return this[INTERNAL].protocol ?? (this.isSecureEndpoint() ? 'https:' : 'http:');\n  }\n  set protocol(v) {\n    if (this[INTERNAL]) {\n      this[INTERNAL].protocol = v;\n    }\n  }\n}\nexports.Agent = Agent;","map":{"version":3,"names":["http","__importStar","require","__exportStar","exports","INTERNAL","Symbol","Agent","constructor","opts","isSecureEndpoint","options","secureEndpoint","protocol","stack","Error","split","some","l","indexOf","createSocket","req","cb","connectOpts","Promise","resolve","then","connect","socket","addRequest","currentSocket","createConnection","undefined","defaultPort","v"],"sources":["../src/index.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}